{% if site.google_scholar_stats_use_cdn %}
{% assign gsDataBaseUrl = "https://cdn.jsdelivr.net/gh/" | append: site.repository | append: "@" %}
{% else %}
{% assign gsDataBaseUrl = "https://raw.githubusercontent.com/" | append: site.repository | append: "/" %}
{% endif %}
{% assign url = gsDataBaseUrl | append: "google-scholar-stats/gs_data.json" %}

<script>
async function loadPublications() {
  const response = await fetch('{{ url }}');
  const data = await response.json();
  const publications = Object.values(data.publications);
  
  // 按年份分组
  const pubsByYear = {};
  publications.forEach(pub => {
    const year = pub.bib.pub_year || 'Unknown';
    if (!pubsByYear[year]) {
      pubsByYear[year] = [];
    }
    pubsByYear[year].push(pub);
  });

  // 按年份排序（降序）
  const years = Object.keys(pubsByYear).sort((a, b) => b - a);
  
  let html = '';
  years.forEach(year => {
    html += `<h2>${year}</h2>\n`;
    pubsByYear[year].forEach(pub => {
      html += '<div class="paper-box">\n';
      if (pub.bib.venue) {
        html += `  <div class="badge">${pub.bib.venue}</div>\n`;
      }
      html += '  <div class="paper-box-text">\n';
      html += `    <div class="paper-title">${pub.bib.title}</div>\n`;
      html += `    <div class="paper-authors">${pub.bib.author}</div>\n`;
      if (pub.pub_url) {
        html += `    <a href="${pub.pub_url}" target="_blank" class="paper-link">[Paper]</a>\n`;
      }
      html += `    <span class="paper-citations">Citations: ${pub.num_citations}</span>\n`;
      html += '  </div>\n</div>\n';
    });
  });

  document.getElementById('publication-list').innerHTML = html;
}

window.addEventListener('load', loadPublications);
</script>

<style>
.paper-box {
  margin-bottom: 2em;
  padding: 1em;
  border: 1px solid #eee;
  border-radius: 4px;
  position: relative;
}

.badge {
  position: absolute;
  top: -12px;
  left: 10px;
  background: #4a4a4a;
  color: white;
  padding: 2px 8px;
  border-radius: 3px;
  font-size: 0.8em;
}

.paper-title {
  font-weight: bold;
  margin-bottom: 0.5em;
  margin-top: 0.5em;
}

.paper-authors {
  color: #666;
  margin-bottom: 0.5em;
}

.paper-link {
  display: inline-block;
  margin-right: 1em;
  color: #2196F3;
  text-decoration: none;
}

.paper-citations {
  color: #666;
  font-size: 0.9em;
}
</style>

<div id="publication-list">
  Loading publications...
</div>
